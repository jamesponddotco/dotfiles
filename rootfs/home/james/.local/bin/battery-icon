#!/usr/bin/env bash

charge="$(upower -i '/org/freedesktop/UPower/devices/battery_BAT0' \
  | awk '/percentage/ { sub("%", "", $2); printf $2 }')"
state="$(upower -i '/org/freedesktop/UPower/devices/battery_BAT0' \
  | awk '/state/ {printf $2}')"
icon_path="${HOME}/.local/share/icons/Adwaita/"

if [[ "${state}" == "discharging" ]]; then
  tooltip='Time to empty:'
  time="$(upower -i '/org/freedesktop/UPower/devices/battery_BAT0' \
    | awk '/time to empty/ {printf "%s %s", $4, $5}')"

  if [[ "${charge}" -ge 90 ]]; then
    icon='battery-level-100-symbolic.svg'
  elif [[ "${charge}" -ge 80 ]]; then
    icon='battery-level-90-symbolic.svg'
  elif [[ "${charge}" -ge 70 ]]; then
    icon='battery-level-80-symbolic.svg'
  elif [[ "${charge}" -ge 60 ]]; then
    icon='battery-level-70-symbolic.svg'
  elif [[ "${charge}" -ge 50 ]]; then
    icon='battery-level-60-symbolic.svg'
  elif [[ "${charge}" -ge 40 ]]; then
    icon='battery-level-50-symbolic.svg'
  elif [[ "${charge}" -ge 30 ]]; then
    icon='battery-level-40-symbolic.svg'
  elif [[ "${charge}" -ge 20 ]]; then
    icon='battery-level-30-symbolic.svg'
  elif [[ "${charge}" -ge 10 ]]; then
    icon='battery-level-20-symbolic.svg'
  elif [[ "${charge}" -ge 5 ]]; then
    icon='battery-level-10-symbolic.svg'
  else
    icon='battery-level-0-symbolic.svg'
  fi
else
  tooltip='Time to full:'
  time="$(upower -i '/org/freedesktop/UPower/devices/battery_BAT0' \
    | awk '/time to full/ {printf "%s %s", $4, $5}')"

  if [[ "${charge}" -ge 90 ]]; then
    icon='battery-level-100-charged-symbolic.svg'
  elif [[ "${charge}" -ge 80 ]]; then
    icon='battery-level-90-charging-symbolic.svg'
  elif [[ "${charge}" -ge 70 ]]; then
    icon='battery-level-80-charging-symbolic.svg'
  elif [[ "${charge}" -ge 60 ]]; then
    icon='battery-level-70-charging-symbolic.svg'
  elif [[ "${charge}" -ge 50 ]]; then
    icon='battery-level-60-charging-symbolic.svg'
  elif [[ "${charge}" -ge 40 ]]; then
    icon='battery-level-50-charging-symbolic.svg'
  elif [[ "${charge}" -ge 30 ]]; then
    icon='battery-level-40-charging-symbolic.svg'
  elif [[ "${charge}" -ge 20 ]]; then
    icon='battery-level-30-charging-symbolic.svg'
  elif [[ "${charge}" -ge 10 ]]; then
    icon='battery-level-20-charging-symbolic.svg'
  elif [[ "${charge}" -ge 5 ]]; then
    icon='battery-level-10-charging-symbolic.svg'
  else
    icon='battery-level-0-charging-symbolic.svg'
  fi
fi

printf '%s\n%s%% (%s %s)' "${icon_path}${icon}" "${charge}" "${tooltip}" "${time}"

# All was well.
exit 0
