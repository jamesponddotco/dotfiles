#!/usr/bin/env bash
#
# Script Name: mfdl
# Script URL: https://git.sr.ht/~jamesponddotco/dotfiles
# Description: Download files from MediaFire.
# Version: 0.1.0
# Author: James Pond
# Author URL: https://jamespond.co/
# License: European Union Public License 1.2 or later
# License URI: https://joinup.ec.europa.eu/collection/eupl/eupl-text-11-12
#

# Use bash's "unofficial strict mode".
set -o errexit -o nounset -o errtrace -o pipefail
IFS=$'\n\t'

# Force all output to use the simplest locale.
LC_ALL='C'
readonly LC_ALL

# Store the user input, download URL, and filename in their own variables for
# easier manipulation.
mediafire_url="${1:-}" mediafire_url="${mediafire_url,,}"
readonly mediafire_url
mediafire_download_url="$(curl --url "${mediafire_url}" --silent --tlsv1.3 \
  --proto '=https' --compressed \
  | grep ':\/\/download' \
  | awk -F '"' '{print $2}')"
readonly mediafire_download_url

# Download the file using wget with secure defaults. While the regular
# MediaFire URL supports TLS 1.3, we downgrade to TLS 1.2 for the download
# servers because that is their max.
wget --inet4-only --no-cookies --secure-protocol 'TLSv1_2' --https-only \
  --quiet --show-progress "${mediafire_download_url}"

# All was well.
exit 0
