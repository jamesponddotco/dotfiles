#!/usr/bin/env bash
#
# Script Name: Are You TLS 1.3 yet?
# Script URL: https://git.sr.ht/~jamesponddotco/dotfiles
# Description: Check to see if a website supports TLS 1.3.
# Version: 1.0.0
# Author: James Pond
# Author URL: https://jamespond.co/
# License: European Union Public License 1.2 or later
# License URI: https://joinup.ec.europa.eu/collection/eupl/eupl-text-11-12
#

# Enable "bash strict mode".
# http://redsymbol.net/articles/unofficial-bash-strict-mode/
set -euo pipefail
IFS=$'\n\t'

# GIMME COLOURS!
# Color variables to make our output a little easier on the eyes.
readonly text_red="\033[1;31m"
readonly text_green="\033[1;32m"
readonly text_bold="\033[1m"
readonly text_reset="\033[0m"

# Normalize the URL given by the user.
domain_to_test="$(echo "$1" | cut -d'/' -f3 | cut -d':' -f1)"

# Check what the status code for `openssl s_client connect` returns, and tell
# the user if the website supports TLS 1.3 or not.
if openssl s_client -tls1_3 -connect "$domain_to_test":443 < /dev/null > /dev/null 2>&1; then
  echo -e "${text_bold}${text_green}Yes!${text_reset}"
else
  echo -e "${text_bold}${text_red}No.${text_reset}"
fi

# All was well.
exit 0
