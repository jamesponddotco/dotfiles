#!/usr/bin/env bash
#
# Script Name: Flush 'n' Lock
# Script URL: https://git.sr.ht/~jamesponddotco/dotfiles
# Description: Flush credentials from memory, and lock the screen.
# Version: 1.0.0
# Author: James Pond
# Author URL: https://jamespond.co/
# License: European Union Public License 1.2 or later
# License URI: https://joinup.ec.europa.eu/collection/eupl/eupl-text-11-12
#

# Enable "bash strict mode".
# http://redsymbol.net/articles/unofficial-bash-strict-mode/
set -euo pipefail
IFS=$'\n\t'

# Flush GPG, SSH, sudo, and 1Password credentials from memory.
gpg-connect-agent reloadagent /bye &> /dev/null
ssh-add -qD
sudo -K
op signout

# Lock the screen. This is handled by GDM3, I think, so it will probably not
# work everywhere. It does for Regolith Linux, and Ubuntu, though.
dbus-send --type=method_call \
  --dest=org.gnome.ScreenSaver /org/gnome/ScreenSaver \
  org.gnome.ScreenSaver.Lock

# All was well.
exit 0
