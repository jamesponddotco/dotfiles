#!/usr/bin/env bash
#
# Script Name: OneBloated 8T
# Script URL: https://git.sr.ht/~jamesponddotco/onebloated8t
# Description: Remove bloatware present in the default OnePlus 8T image.
# Version: 0.1.0
# Author: James Pond
# Author URL: https://jamespond.co/
# License: GNU General Public License v2 or later
# License URI: http://www.gnu.org/licenses/gpl-2.0.html
#

# Use bash's "unofficial strict mode".
set -o errexit -o nounset -o errtrace -o pipefail
IFS=$'\n\t'

# Force all output to use the simplest locale.
LC_ALL='C'
readonly LC_ALL

# Color variables to make our output a little easier on the eyes. Respect
# NO_COLOR, in case the user does not want any.
if [[ -t 1 && -z "${NO_COLOR:-}" ]]; then
  c_red='\033[0;31m'
  c_bold='\033[1m'
  c_reset='\033[0m'
  readonly c_red
  readonly c_bold
  readonly c_reset
fi

# Start the ADB server.
adb start-server

# Check to see if the user is running the script with an OnePlus 8T connected
# by getting the device name from the device itself.
readonly device_name="$(adb shell getprop 'ro.display.series' >/dev/null 2>&1)"
if ! [[ "${device_name:-}" == 'OnePlus 8T' ]]; then
  echo -e "${c_red:-}${c_bold:-}[ERROR]${c_reset:-} No device or wrong device \
connected. Please make sure you only have"
  exit 1
fi

# Connect to the phone and open a shell to remove bloatware.
adb shell "
  pm uninstall --user 0 com.google.android.apps.subscriptions.red
  pm uninstall --user 0 com.google.android.apps.podcasts
  pm uninstall --user 0 com.google.android.apps.messaging
  pm uninstall --user 0 com.google.android.apps.work.oobconfig
  pm uninstall --user 0 com.google.android.apps.tachyon
  pm uninstall --user 0 com.google.android.apps.docs
  pm uninstall --user 0 com.google.android.apps.maps
  pm uninstall --user 0 com.google.android.apps.walletnfcrel
  pm uninstall --user 0 com.google.android.apps.photos
  pm uninstall --user 0 com.google.android.apps.turbo
  pm uninstall --user 0 com.google.android.apps.youtube.music
  pm uninstall --user 0 com.google.android.apps.magazines
  pm uninstall --user 0 com.google.android.apps.restore
  pm uninstall --user 0 com.google.android.youtube
  pm uninstall --user 0 com.google.android.googlequicksearchbox
  pm uninstall --user 0 com.google.android.videos
  pm uninstall --user 0 com.google.android.feedback
  pm uninstall --user 0 com.google.android.apps.photos
  pm uninstall --user 0 com.google.android.calendar
  pm uninstall --user 0 com.google.android.projection.gearhead
  pm uninstall --user 0 com.google.android.apps.wellbeing
  pm uninstall --user 0 com.qualcomm.qti.cne
  pm uninstall --user 0 com.qualcomm.uimremoteclient
  pm uninstall --user 0 com.qualcomm.uimremoteserver
  pm uninstall --user 0 com.android.emergency
  pm uninstall --user 0 com.oneplus.faceunlock
  pm uninstall --user 0 com.oneplus.gamespace
  pm uninstall --user 0 com.google.ar.core
  pm uninstall --user 0 com.oneplus.account
  pm uninstall --user 0 com.android.managedprovisioning
  pm uninstall --user 0 com.oneplus.brickmode
  pm uninstall --user 0 net.oneplus.commonlogtool
  pm uninstall --user 0 com.oneplus.factorymode
  pm uninstall --user 0 com.oneplus.factorymode.specialtest
  pm uninstall --user 0 com.oneplus.iconpack.square
  pm uninstall --user 0 com.oneplus.opbugreportlite
  pm uninstall --user 0 com.oneplus.diagnosemanager
  pm uninstall --user 0 com.oneplus.diagnoseManager
  pm uninstall --user 0 com.oneplus.backuprestore.remoteservice
  pm uninstall --user 0 com.google.mainline.telemetry
  pm uninstall --user 0 com.google.android.marvin.talkback
  pm uninstall --user 0 com.quicinc.voice.activation
  pm uninstall --user 0 com.amazon.appmanager
  pm uninstall --user 0 com.android.hotwordenrollment.xgoogle
  pm uninstall --user 0 com.android.hotwordenrollment.okgoogle
  pm uninstall --user 0 net.oneplus.forums
  pm uninstall --user 0 com.oneplus.filemanager
  pm uninstall --user 0 net.oneplus.launcher
  pm uninstall --user 0 com.oneplus.soundrecorder
  pm uninstall --user 0 com.android.chrome
  pm uninstall --user 0 com.oneplus.note
  pm uninstall --user 0 net.oneplus.weather
  pm uninstall --user 0 com.oneplus.gallery
  pm uninstall --user 0 com.oneplus.camera
  pm uninstall --user 0 com.google.android.gm
  pm uninstall --user 0 com.google.android.contacts
  pm uninstall --user 0 com.oneplus.calculator
  pm uninstall --user 0 com.google.android.dialer
  pm uninstall --user 0 com.oneplus.backuprestore
  pm uninstall --user 0 com.oneplus.backuprestore.remoteservice
  pm uninstall --user 0 cn.oneplus.nvbackup"

# All was well.
exit 0
